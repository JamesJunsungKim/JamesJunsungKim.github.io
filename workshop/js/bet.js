var user_input,user_path,coins_for_this_round=0,total_available_coins=0,is_game_on=!1,currentlySumOfCoins=0,reach_limit=!1,popup_instance=$("#popup");function is_popup_displaying(){return!popup_instance.css("display","none")}function show_popup(e){$(".modal-content .message").html(e),popup_instance.show(10).delay(1500).hide(15)}function remove_current_input_and_reset_placeholder(){$(".input100").removeClass("has-val"),$("#number_of_coins").val("")}function show_or_hide_unavailable_container(e,a){var n=$("#unavailable_container"),i=$("#input_container");e?(a?n.html(a):n.html("코인을 다 쓰셨어요!"),i.hide(),n.show(15)):(i.show(15),n.hide(15),n.html("게임이 진행중 입니다!"))}function handleGameStatusAndShowUnavailableCotainer(e,a){0==total_available_coins?show_or_hide_unavailable_container(!0,"코인을 다 쓰셨어요!"):is_game_on?show_or_hide_unavailable_container(!0,"게임이 진행중 입니다!"):reach_limit?show_or_hide_unavailable_container(!0,"코인 배팅 한도에 도달했습니다. 일찍 하셨어야.."):show_or_hide_unavailable_container(e,a)}function uuidv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var a=16*Math.random()|0;return("x"==e?a:3&a|8).toString(16)})}function resetJames(){firebase.database().ref("currently_in_round").set("")}!function(e){e("#unavailable_container").hide(),e(".initially-hidden").hide(),popup_instance.hide(),e(".input100").on("blur",function(){""!=e(this).val().trim()?e(this).addClass("has-val"):e(this).removeClass("has-val")});firebase.initializeApp({apiKey:"AIzaSyCEMGdUHa0fhbf5A3IpLTCajDc6sJAbMMI",authDomain:"raffle-workshop.firebaseapp.com",databaseURL:"https://raffle-workshop.firebaseio.com",projectId:"raffle-workshop",storageBucket:"",messagingSenderId:"864371302754",appId:"1:864371302754:web:c8228176d5d83320958c3b"});var a=window.location.search.substring(1).split("&")[0].split("id=")[1];firebase.database().ref("user_mapping/"+a).once("value").then(function(a){var n=a.val();user_path=n,e("#user_name").html(n.replace("_",".")),firebase.database().ref("member/"+n).on("value",function(a){var n=a.val().available_coins;total_available_coins=n,e("#available_coins").html(n),Number(n)<=0?handleGameStatusAndShowUnavailableCotainer(!0):handleGameStatusAndShowUnavailableCotainer(!1)})}),firebase.database().ref("status").on("value",function(a){e(".initially-hidden").show(15),is_game_on=a.val().is_game_on;a.val().current_raffle_item,a.val().current_round;var n=e("#input_container"),i=e("#unavailable_container"),t=e("#betted_coins");is_game_on||reach_limit?(n.hide(),coins_for_this_round=0,t.val(0),handleGameStatusAndShowUnavailableCotainer(!0,reach_limit?"코인 배팅 한도에 도달했습니다. 일찍 하셨어야..":"게임이 진행중이에요!")):(n.show(),i.hide(15),t.html("0"))}),firebase.database().ref("currently_in_round").on("value",function(a){if(console.log(a.val()),""==a.val())reach_limit=!1,currentlySumOfCoins=0,e("#betted_coins").html(0),remove_current_input_and_reset_placeholder(),0!=total_available_coins?show_or_hide_unavailable_container(!1):show_or_hide_unavailable_container(!0,"코인을 다 쓰셨어요!");else{dicts=Object.values(a.val());var n=0;for(i=0;i<dicts.length;i++)current_number=dicts[i].number_of_coins,n+=current_number;(reach_limit=(currentlySumOfCoins=n)>=100)?handleGameStatusAndShowUnavailableCotainer(!0,"코인 배팅 한도에 도달했습니다. 일찍 하셨어야.."):handleGameStatusAndShowUnavailableCotainer(!1)}}),e("#betting-button").click(function(){coin_input_element=e("#number_of_coins"),user_input=Number(coin_input_element.val());var a=e("#betted_coins");if(reach_limit)show_or_hide_unavailable_container(!0,"코인 배팅 한도에 도달했습니다. 일찍 하셨어야..");else if(is_game_on)show_popup("게임이 진행중이에요");else if(user_input<=0)remove_current_input_and_reset_placeholder(),show_popup("0이상 입력해주세요.");else if(Number.isInteger(user_input))if(total_available_coins>=user_input){var n=firebase.database().ref("member/"+user_path+"/available_coins"),i=firebase.database().ref("currently_in_round");n.set(total_available_coins-user_input),i.push({name:user_path,number_of_coins:user_input}),show_popup("추가되었습니다!"),remove_current_input_and_reset_placeholder(),a.html(Number(a.html())+user_input)}else remove_current_input_and_reset_placeholder(),show_popup("있는 갯수보다 많이 지원하셨네요.");else remove_current_input_and_reset_placeholder(),show_popup("숫자가 아닌거같아요.<br> 다시 입력해주세요.")}),e(".validate-form").on("submit",function(){return popup_instance.hide(),!1}),e(".modal-content .close").click(function(){popup_instance.hide()}),e(window).click(function(e){class_name=e.target.className,"modal"!=class_name&&"modal_content"!=class_name||popup_instance.hide()})}(jQuery);